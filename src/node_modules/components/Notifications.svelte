{#each toasts as { id, message, theme }, _ (id)}
    <div transition:slidefade class="fixed inset-x-0 top-0 mt-10 inline-flex rounded items-center text-sm font-bold px-4 py-3 mx-auto max-w-sm border leading-none {themes[theme].class}" style="z-index: {100 + id}" role="alert">
        <svg class="fill-current w-6 h-6 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="{themes[theme].path}"/></svg>
        <p>{message}</p>
    </div>
{/each}

<script>
    import { cubicOut } from 'svelte/easing'

    let count = 0
    let toasts = []
    const themes = {
    	warning: {
    		class: 'bg-orange-100 text-orange-600 border-orange-400',
    		path: 'M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20zm0 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16zm0 9a1 1 0 0 1-1-1V8a1 1 0 0 1 2 0v4a1 1 0 0 1-1 1zm0 4a1 1 0 1 1 0-2 1 1 0 0 1 0 2z'
    	},
    	success: {
    		class: 'bg-green-100 text-green-600 border-green-400',
    		path: 'M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm-2.3-8.7l1.3 1.29 3.3-3.3a1 1 0 0 1 1.4 1.42l-4 4a1 1 0 0 1-1.4 0l-2-2a1 1 0 0 1 1.4-1.42z'
    	},
    	error: {
    		class: 'bg-red-100 text-red-600 border-red-400',
    		path: 'M4.93 19.07A10 10 0 1 1 19.07 4.93 10 10 0 0 1 4.93 19.07zm1.41-1.41A8 8 0 1 0 17.66 6.34 8 8 0 0 0 6.34 17.66zM13.41 12l1.42 1.41a1 1 0 1 1-1.42 1.42L12 13.4l-1.41 1.42a1 1 0 1 1-1.42-1.42L10.6 12l-1.42-1.41a1 1 0 1 1 1.42-1.42L12 10.6l1.41-1.42a1 1 0 1 1 1.42 1.42L13.4 12z'
    	},
    	info: {
    		class: 'bg-blue-100 text-blue-600 border-blue-400',
    		path: 'M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-9a1 1 0 0 1 1 1v4a1 1 0 0 1-2 0v-4a1 1 0 0 1 1-1zm0-4a1 1 0 1 1 0 2 1 1 0 0 1 0-2z'
    	}
    }

    setInterval(() => {
    	const currentTime = Date.now()
    	toasts = toasts.filter(({ time, timeout }) => currentTime < time + timeout)
    }, 500)
    
    function slidefade(node, { delay = 0, duration = 400, easing = cubicOut }) {
    	const style = getComputedStyle(node)
    	const opacity = +style.opacity
    	const margin_top = parseFloat(style.marginTop)

    	return {
    		delay,
    		duration,
    		easing,
    		css: t => `opacity: ${t * opacity};` + `margin-top: ${t * margin_top}px;`
    	}
    }
    
    function createToast (message, timeout, theme) {
    	toasts = [{
    		id: count,
    		message,
    		time: Date.now(),
    		timeout,
    		theme
    	}, ...toasts]
    	count += 1
    }

    function show (message, timeout = 3000, theme) {
    	createToast(message, timeout, theme)
    }
        
    export function error (message, timeout) {
    	show(message, timeout, 'error')
    }
        
    export function warning (message, timeout) {
    	show(message, timeout, 'warning')
    }
        
    export function info (message, timeout) {
    	show(message, timeout, 'info')
    }
        
    export function success (message, timeout) {
    	show(message, timeout, 'success')
    }
</script>