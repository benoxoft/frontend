language: node_js

node_js:
  - 12.4.0

services:
- docker

cache:
  npm: true
  directories:
    - ~/.npm
    - ~/.cache

install:
  - npm ci

script:
  - npm test
  - npm run lint

before_deploy:
  - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN registry.gitlab.com

deploy:
  provider: script
  script:
    - docker build -t registry.gitlab.com/mangash/manga-frontend .
    - docker push registry.gitlab.com/mangash/manga-frontend
  skip_cleanup: true
  on:
    branch: master